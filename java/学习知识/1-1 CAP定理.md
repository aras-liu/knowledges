# CAP定理

参考 ：http://www.ruanyifeng.com/blog/2018/07/cap.html

定义：
    C: 一致性
    A: 可用性
    P: 分区容错性

分布式系统的三个指标。

## 1 分区容错性
大部分分布式系统分布在多个子网中，每个子网络就是一个区。分区容错 ，就是区间通信失败。  
一般来说，分区容错一定存在，即P一定存在，所有系统一定要考虑这种情况，当两个区无法进行通信  

一般指的是分布式网络中部分网络不可用时, 系统依然正常对外提供服务

## 2 一致性
写操作之后的读操作，必须返回该值。  
> 对G0,G1 (V0) 两个集群主机进行操作，  
> 1. 对G0 写操作V1  
> 2. 立即，从G0 或者G1 读，都要读取到同一个值V1。  
> 这样才能保证一致性，如果结果不一致，就没有保证一致性。

## 3 可用性
Availability 中文叫做"可用性"，意思是只要收到用户的请求，服务器就必须给出回应。
用户可以选择向 G1 或 G2 发起读操作。不管是哪台服务器，只要收到请求，就必须告诉用户，到底是 v0 还是 v1，否则就不满足可用性。

## 4 Consistency 和 Availability 的矛盾   
一致性和可用性，为什么不可能同时成立？答案很简单，因为可能通信失败（即出现分区容错）。


如果保证 G2 的一致性，那么 G1 必须在写操作时，锁定 G2 的读操作和写操作。只有数据同步后，才能重新开放读写。锁定期间，G2 不能读写，没有可用性。

如果保证 G2 的可用性，那么势必不能锁定 G2，所以一致性不成立。

综上所述，G2 无法同时做到一致性和可用性。系统设计时只能选择一个目标。如果追求一致性，那么无法保证所有节点的可用性；如果追求所有节点的可用性，那就没法做到一致性。

## 5 容错 高可用 灾备

容错：发生故障时，如何让系统继续运行。  
高可用：系统中断时，如何尽快恢复。  
灾备：系统毁灭时，如何抢救数据。  

##  6 不得不说的BASE定理
BASE是  
Basically Available(基本可用)、
Soft state(软状态)  和
Eventually consistent(最终一致性) 三个短语的缩写

```
BASE定理来源：是CAP中一致性和可用性的权衡结果，它来自大规模互联网分布式系统的总结，是基于CAP定理逐步演化而来的。
```

```
BASE定理的核心思想：即使无法做到强一致性，但是每个应用可以根据自身的业务特定，采用合适的方式来达到最终一致性。
```

- 损失相应时间:CAP可用性的服务相应时间可能是10ms，而BASE基本可用性的相应时间1-2s，即允许损失部分可用性的(时间上的损失）
- 损失系统功能：BASE的基本可用性是允许某个服务出现故障时，采用服务降级等手段保证用户的体验性，即允许损失部分系统功能。
- 允许系统中的数据存在中间状态，并认为该状态不影响系统的整体可用性，即允许系统在多个不同节点的数据副本存在数据延时。

### 最终一致性（Eventually Consistent）
系统中所有的数据副本，在经过一段时间的同步后，最终能够达到一个一致的状态而不需要实时保证系统数据的强一致性。